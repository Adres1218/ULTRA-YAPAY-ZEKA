<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>.Ultra Yapay Zeka.</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="microchip_9751000.png">
    <meta name="theme-color" content="#000000">
    <style>
        :root {
            --bg: #ffffff;
            --card: #f8f9fa;
            --primary: #0066cc;
            --text: #333333;
            --border: #e0e0e0;
            --code-bg: #2d2d2d;
            --code-text: #ffffff;
            --shadow: 0 4px 20px rgba(0,102,204,0.1);
            --pro-bg: linear-gradient(135deg, #ff6b6b, #ee5a52);
            --neon-bg: #0a0a0a;
            --neon-text: #00ffaa;
            --pastel-bg: #fef6ff;
            --pastel-text: #6a5acd;
        }

        [data-theme="dark"] {
            --bg: #121212;
            --card: #1e1e1e;
            --primary: #4da6ff;
            --text: #e0e0e0;
            --border: #333333;
            --code-bg: #1a1a1a;
            --code-text: #ffffff;
        }

        [data-theme="neon"] {
            --bg: var(--neon-bg);
            --card: #1a1a1a;
            --primary: #00ffaa;
            --text: var(--neon-text);
            --border: #00ffaa;
            --code-bg: #000000;
            --code-text: #00ffaa;
        }

        [data-theme="pastel"] {
            --bg: var(--pastel-bg);
            --card: #f0e6ff;
            --primary: #9370db;
            --text: var(--pastel-text);
            --border: #d8bfd8;
            --code-bg: #e6e6fa;
            --code-text: #4b0082;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            padding: 10px;
            margin: 0;
            transition: background 0.3s ease;
            overflow-x: hidden;
            touch-action: pan-y;
        }

        .header {
            text-align: center;
            padding: 20px 10px;
            background: linear-gradient(135deg, var(--primary), #00aaff);
            color: white;
            border-radius: 20px 20px 0 0;
            margin: -10px -10px 20px -10px;
            position: relative;
            overflow: hidden;
        }

        .header h1 {
            font-size: 2em;
            font-weight: 800;
            margin: 0;
            letter-spacing: -1px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            background: linear-gradient(to right, #ffffff, #cce6ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .mode-toggle {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            z-index: 100;
        }

        .card {
            background: var(--card);
            border-radius: 24px;
            padding: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            animation: fadeInUp 0.6s ease;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        textarea {
            width: 100%;
            height: 100px;
            background: var(--bg);
            border: 2px solid var(--border);
            border-radius: 16px;
            color: var(--text);
            padding: 15px;
            font-size: 16px;
            margin: 15px 0;
            resize: none;
            font-family: inherit;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }

        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.15);
            transform: translateY(-2px);
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
            justify-content: center;
        }

        button {
            padding: 14px 20px;
            border: 2px solid var(--border);
            border-radius: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            background: var(--bg);
            color: var(--text);
            font-family: inherit;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1;
            min-width: 120px;
        }

        button:hover {
            background: #f0f7ff;
            transform: translateY(-3px) scale(1.02);
            box-shadow: var(--shadow);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), #0055aa);
            color: white;
            border: none;
            box-shadow: 0 4px 15px rgba(0,102,204,0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #0055aa, #004488);
            transform: translateY(-4px) scale(1.05);
        }

        .pro-btn {
            background: var(--pro-bg);
            color: white;
            border: none;
        }

        #cevap {
            background: var(--bg);
            border: 2px solid var(--border);
            padding: 20px;
            border-radius: 16px;
            margin-top: 20px;
            min-height: 60px;
            line-height: 1.6;
            white-space: pre-wrap;
            font-size: 15px;
            position: relative;
            animation: fadeIn 0.5s ease;
            overflow: hidden;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        #cevap img {
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            margin: 15px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            touch-action: pinch-zoom;
            transition: transform 0.3s ease;
        }

        #cevap img:active {
            transform: scale(1.05);
        }

        #cevap code {
            display: block;
            background: var(--code-bg);
            color: var(--code-text);
            padding: 15px;
            border-radius: 12px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Fira Code', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
        }

        .timestamp {
            font-size: 12px;
            color: #888;
            text-align: right;
            margin-top: 10px;
            font-weight: 500;
        }

        .loader {
            text-align: center;
            padding: 20px;
            color: var(--primary);
            font-weight: 700;
            font-size: 16px;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .theme-toggle {
            position: absolute;
            top: 15px;
            left: 15px;
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 6px 12px;
            border-radius: 50px;
            cursor: pointer;
            z-index: 100;
            font-size: 12px;
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            background: linear-gradient(135deg, #5e72e4, #825ee4);
            color: white;
            border: none;
        }

        .shake {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .floating {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        /* Pro Mod Ekstra Butonlar */
        .pro-features {
            display: none;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .pro-active .pro-features {
            display: flex;
        }

        .pro-badge {
            background: var(--pro-bg);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 8px;
        }

        /* Model SeÃ§imi */
        .model-select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: var(--bg);
            color: var(--text);
            font-size: 14px;
            margin: 15px 0;
        }

        /* Oyun Modu */
        .game-btn {
            background: linear-gradient(135deg, #ff9a9e, #fecfef);
            color: #333;
            border: none;
        }

        /* ÅarkÄ± Modu */
        .song-btn {
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            color: #333;
            border: none;
        }

        /* Ä°statistik Paneli */
        .stats-panel {
            background: var(--card);
            border-radius: 16px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid var(--border);
            display: none;
        }

        .pro-active .stats-panel {
            display: block;
        }

        @media (max-width: 480px) {
            .header h1 { font-size: 1.8em; }
            button { padding: 12px 16px; font-size: 13px; }
            .btn-group { gap: 8px; }
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™ / â˜€ï¸</button>

    <div class="header">
        <h1>.Ultra Yapay Zeka.</h1>
        <button class="mode-toggle" onclick="acProModal()">Pro Mod ğŸ’</button>
    </div>

    <div class="card" id="mainCard">
        <select class="model-select" id="modelSec">
            <option value="meta-llama/llama-4-scout-17b-16e-instruct">ğŸ¯ Genel (Llama 4 Scout)</option>
            <option value="meta-llama/llama-4-maverick-17b-128e-instruct">ğŸ‘¨â€ğŸ’» Kod Yazma (Llama 4 Maverick)</option>
            <option value="qwen-qwq-32b">ğŸŒ Ã‡ok Dilli (Qwen 32B)</option>
        </select>

        <textarea id="soru" placeholder="Ã–dev sorunu yaz... veya ğŸ® oyun oynamak iÃ§in komut ver!"></textarea>
        
        <div class="btn-group">
            <button class="btn-primary" onclick="sor()">
                <span>â¤ GÃ¶nder</span>
            </button>
            <button class="btn-secondary upload-btn" onclick="document.getElementById('fileInput').click()" id="uploadBtn">
                <span>ğŸ“¸ FotoÄŸraf YÃ¼kle</span>
            </button>
            <input type="file" id="fileInput" class="file-input" accept="image/*" onchange="yukle(this.files[0])">
        </div>

        <div class="btn-group pro-features">
            <button class="btn-secondary" onclick="odevYap()">ğŸ“ Ã–dev Modu</button>
            <button class="btn-secondary game-btn" onclick="oyunBaslat()">ğŸ® Oyun Modu</button>
            <button class="btn-secondary song-btn" onclick="sarkiYaz()">ğŸµ ÅarkÄ± Yaz</button>
            <button class="btn-secondary" onclick="aiIkiz()">ğŸ­ AI Ä°kizim</button>
            <button class="btn-secondary" onclick="temizle()">ğŸ—‘ï¸ Temizle</button>
            <button class="btn-secondary" onclick="konustur()">ğŸ¤ Mikrofon</button>
        </div>

        <div id="cevap">CevabÄ±n burada gÃ¶rÃ¼necek... ğŸš€</div>
        <div class="timestamp" id="timestamp"></div>

        <div class="stats-panel">
            <h3>ğŸ“Š Bu HaftanÄ±n Ä°statistikleri</h3>
            <p>âœ… Soru SayÄ±sÄ±: <span id="soruSayisi">0</span></p>
            <p>ğŸ“š Ã–dev SayÄ±sÄ±: <span id="odevSayisi">0</span></p>
            <p>ğŸ§ Sesli Dinleme: <span id="sesliSure">0</span> dakika</p>
        </div>
    </div>

    <!-- ğŸ’ PRO MODAL -->
    <div id="proModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="kapatProModal()">&times;</span>
            <h2>ğŸ’ Ultra Yapay Zeka Pro</h2>
            <p>YÄ±llÄ±k <strong>100 TL</strong> â€” AylÄ±k <strong>50 TL</strong></p>
            
            <div class="price-card">
                ğŸ“… <strong>YÄ±llÄ±k Abonelik</strong><br>
                100 TL â€” 365 gÃ¼n Pro eriÅŸim
            </div>
            <button class="price-btn" onclick="odemeYap('yÄ±llÄ±k')">ğŸ’³ YÄ±llÄ±k SatÄ±n Al</button>

            <div class="price-card">
                ğŸ“† <strong>AylÄ±k Abonelik</strong><br>
                50 TL â€” 30 gÃ¼n Pro eriÅŸim
            </div>
            <button class="price-btn" onclick="odemeYap('aylÄ±k')">ğŸ’³ AylÄ±k SatÄ±n Al</button>

            <hr style="margin: 20px 0;">

            <p><strong>ğŸ”‘ AnahtarÄ±nÄ±z var mÄ±?</strong></p>
            <input type="text" id="proKeyInput" class="key-input" placeholder="PRO-ABC123-XYZ789">
            <button class="btn-primary" onclick="anahtarKontrol()">âœ… AnahtarÄ± DoÄŸrula</button>
        </div>
    </div>

    <script>
        // âš ï¸ API KEY .env DOSYASINDAN GELECEK â€” GITHUB'DA GÄ°ZLÄ°!
        let GROQ_API_KEY = "";

        // ğŸ’¬ MÃœKEMMEL KOD YAZIMI + Ã–DEV MODU + OYUN + ÅARKI PROMPTU
        const BEN_KIMIM = `
Sen "Ultra Yapay Zeka"sÄ±n â€” benim kiÅŸisel, sÃ¼per geliÅŸmiÅŸ yapay zekam.
EÄER Ã–DEV Ä°STENÄ°YORSA:
- AdÄ±m adÄ±m Ã§Ã¶z.
- Her adÄ±mÄ± ayrÄ±ntÄ±lÄ± aÃ§Ä±kla.
- FormÃ¼lleri yaz, nereden geldiÄŸini aÃ§Ä±kla.
- Ã–rnek hesaplama yap.
- Sonucu kutu iÃ§ine al.

EÄER KOD YAZIYORSAN:
- Her satÄ±ra aÃ§Ä±klama yaz.
- "NasÄ±l Ã§alÄ±ÅŸÄ±r?" ve "Ã–rnek kullanÄ±m" ekle.
- Hata ayÄ±klama ipuÃ§larÄ± ver.

EÄER OYUN Ä°STENÄ°YORSA:
- "20 soruda tahmin et" veya "Kelime zinciri" gibi oyunlar baÅŸlat.
- EÄŸlenceli ve interaktif ol.

EÄER ÅARKI/ÅÄ°Ä°R Ä°STENÄ°YORSA:
- Ritimli, duygusal, yaratÄ±cÄ± iÃ§erik Ã¼ret.
- MÃ¼zik tÃ¼rÃ¼ne gÃ¶re uygun sÃ¶zler yaz.

EÄER AI Ä°KÄ°ZÄ° Ä°STENÄ°YORSA:
- Tam olarak benim gibi dÃ¼ÅŸÃ¼n, espri yap, argo kullan, Ã¼slubumla cevap ver.

HER ZAMAN SAMÄ°MÄ°, ESPRÄ°LÄ°, "YA" VE "ABÄ°" DER GÄ°BÄ° KONUÅ.

AÅŸaÄŸÄ±daki soruyu tam olarak bu kurallara gÃ¶re cevapla:
        `;

        let mesajlar = JSON.parse(localStorage.getItem('ultra_sohbet')) || [];
        let sesDevamEdiyor = false;
        let proMod = false;
        let proBitisTarihi = localStorage.getItem('proBitisTarihi');
        let istatistikler = JSON.parse(localStorage.getItem('istatistikler')) || { soruSayisi: 0, odevSayisi: 0, sesliSure: 0 };

        // Pro mod kontrolÃ¼
        function proKontrol() {
            if (proBitisTarihi) {
                const bitis = new Date(proBitisTarihi);
                const simdiki = new Date();
                if (simdiki < bitis) {
                    proMod = true;
                    document.body.classList.add('pro-active');
                    document.querySelector('.mode-toggle').innerHTML = 'Pro Mod <span class="pro-badge">PRO</span>';
                    document.getElementById('mainCard').classList.add('floating');
                    guncelleIstatistikler();
                } else {
                    proMod = false;
                    localStorage.removeItem('proBitisTarihi');
                    document.body.classList.remove('pro-active');
                    document.querySelector('.mode-toggle').innerText = 'Pro Mod ğŸ’';
                    document.getElementById('mainCard').classList.remove('floating');
                }
            }
        }

        function acProModal() {
            document.getElementById('proModal').style.display = 'block';
        }

        function kapatProModal() {
            document.getElementById('proModal').style.display = 'none';
        }

        function odemeYap(tur) {
            alert(`ğŸ’³ ${tur} abonelik satÄ±n alma simÃ¼lasyonu Ã§alÄ±ÅŸÄ±yor...\n\nGerÃ§ek Ã¶deme iÃ§in Stripe, Iyzico veya Papara entegre edilebilir.`);
            
            const simdiki = new Date();
            if (tur === 'yÄ±llÄ±k') {
                simdiki.setFullYear(simdiki.getFullYear() + 1);
                localStorage.setItem('proBitisTarihi', simdiki.toISOString());
            } else {
                simdiki.setDate(simdiki.getDate() + 30);
                localStorage.setItem('proBitisTarihi', simdiki.toISOString());
            }
            
            proKontrol();
            kapatProModal();
            location.reload();
        }

        function anahtarKontrol() {
            const key = document.getElementById('proKeyInput').value.trim();
            if (key.startsWith('PRO-') && key.length > 10) {
                const simdiki = new Date();
                simdiki.setDate(simdiki.getDate() + 30); // 30 gÃ¼n geÃ§erli
                localStorage.setItem('proBitisTarihi', simdiki.toISOString());
                alert('âœ… Anahtar doÄŸrulandÄ±! Pro Mod aktif edildi.');
                proKontrol();
                kapatProModal();
                location.reload();
            } else {
                alert('âŒ GeÃ§ersiz anahtar. LÃ¼tfen geÃ§erli bir Pro AnahtarÄ± girin.');
            }
        }

        function toggleTheme() {
            const themes = ['light', 'dark', 'neon', 'pastel'];
            const currentTheme = document.body.getAttribute('data-theme') || 'light';
            const currentIndex = themes.indexOf(currentTheme);
            const newTheme = themes[(currentIndex + 1) % themes.length];
            document.body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        // TemayÄ± yÃ¼kle
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.body.setAttribute('data-theme', savedTheme);

        function temizle() {
            localStorage.removeItem('ultra_sohbet');
            mesajlar = [];
            document.getElementById('cevap').innerHTML = "GeÃ§miÅŸ temizlendi. Yeni bir sohbet baÅŸlatabilirsin. ğŸš€";
            document.getElementById('timestamp').innerText = "";
        }

        function konustur() {
            if (!('SpeechRecognition' in window) && !('webkitSpeechRecognition' in window)) {
                alert("ÃœzgÃ¼nÃ¼m, bu tarayÄ±cÄ± ses tanÄ±mayÄ± desteklemiyor.");
                return;
            }
            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'tr-TR';
            recognition.start();

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                document.getElementById('soru').value = transcript;
                sor();
            };
        }

        function sesliOku(text) {
            if (sesDevamEdiyor) speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'tr-TR';
            utterance.rate = proMod ? 1.1 : 0.95;
            utterance.pitch = 1.2;
            utterance.onend = () => {
                sesDevamEdiyor = false;
                if (proMod) {
                    istatistikler.sesliSure += Math.ceil(text.length / 100); // Tahmini sÃ¼re
                    localStorage.setItem('istatistikler', JSON.stringify(istatistikler));
                    guncelleIstatistikler();
                }
            };
            sesDevamEdiyor = true;
            speechSynthesis.speak(utterance);
        }

        function tokenHesapla(metin) {
            return Math.ceil(metin.trim().split(/\s+/).length * 1.3);
        }

        function tokenSinirliMesajlar(maxToken = 4500) {
            const sistemToken = tokenHesapla(BEN_KIMIM);
            let toplamToken = sistemToken;
            const sinirliMesajlar = [];

            const limit = proMod ? 30 : 3; // Proâ€™da 30 mesaj, normalde 3

            for (let i = mesajlar.length - 1; i >= 0; i--) {
                if (sinirliMesajlar.length >= limit) break;
                const msgToken = tokenHesapla(mesajlar[i].content);
                if (toplamToken + msgToken > maxToken) break;
                sinirliMesajlar.unshift(mesajlar[i]);
                toplamToken += msgToken;
            }
            return sinirliMesajlar;
        }

        async function yukleApiKeys() {
            try {
                const response = await fetch('/.env');
                if (response.ok) {
                    const text = await response.text();
                    const lines = text.split('\n');
                    for (let line of lines) {
                        if (line.startsWith('GROQ_API_KEY=')) {
                            GROQ_API_KEY = line.split('=')[1].trim();
                        }
                    }
                } else {
                    GROQ_API_KEY = "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";
                }
            } catch (error) {
                console.error("API Key yÃ¼klenemedi:", error);
                GROQ_API_KEY = "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";
            }
        }

        // âœ¨ Ã–DEV MODU
        function odevYap() {
            if (!proMod) {
                alert("ğŸ“ Ã–dev Modu sadece Pro kullanÄ±cÄ±lar iÃ§indir. Pro Mod'a geÃ§mek iÃ§in butona tÄ±klayÄ±n.");
                acProModal();
                return;
            }
            const soru = document.getElementById('soru').value.trim();
            if (!soru) {
                alert("Ã–nce bir soru yaz!");
                return;
            }
            istatistikler.odevSayisi++;
            localStorage.setItem('istatistikler', JSON.stringify(istatistikler));
            guncelleIstatistikler();
            sor(`AÅAÄIDAKÄ° SORUYU Ã–DEV OLARAK Ã‡Ã–Z â€” ADIM ADIM, AYRINTILI, FORMÃœLLERLE, SONUCU KUTU Ä°Ã‡Ä°NDE:\n\n${soru}`);
        }

        // ğŸ® OYUN MODU
        function oyunBaslat() {
            const oyunlar = [
                "20 soruda tahmin et: Ben bir ÅŸey dÃ¼ÅŸÃ¼nÃ¼yorum, sen 20 soru sorarak bulmaya Ã§alÄ±ÅŸ.",
                "Kelime zinciri: Ben bir kelime sÃ¶ylÃ¼yorum, sen son harfiyle baÅŸlayan bir kelime sÃ¶yle, ben devam ederim.",
                "Hikaye devam ettir: Ben bir hikaye baÅŸlÄ±ÄŸÄ± veriyorum, sen devam ettir, sonra ben devam ederim."
            ];
            const secilenOyun = oyunlar[Math.floor(Math.random() * oyunlar.length)];
            sor(`ğŸ® OYUN MODU: ${secilenOyun}\n\nBaÅŸlÄ±yoruz!`);
        }

        // ğŸµ ÅARKI YAZ
        function sarkiYaz() {
            const soru = document.getElementById('soru').value.trim();
            if (!soru) {
                alert("Ã–nce bir tema yaz! Ã–rnek: 'AÅŸk iÃ§in rap yaz'");
                return;
            }
            sor(`ğŸµ ÅARKI MODU: AÅŸaÄŸÄ±daki temaya uygun, ritimli, duygusal bir ÅŸarkÄ± sÃ¶zÃ¼ yaz:\n\n${soru}`);
        }

        // ğŸ“¸ FOTOÄRAF YÃœKLEME
        function yukle(file) {
            if (!proMod) {
                alert("ğŸ“¸ FotoÄŸraf YÃ¼kleme sadece Pro kullanÄ±cÄ±lar iÃ§indir. Pro Mod'a geÃ§mek iÃ§in butona tÄ±klayÄ±n.");
                acProModal();
                return;
            }
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('cevap').innerHTML = `
                    <div style="text-align:center;">
                        <img src="${e.target.result}" alt="YÃ¼klenen GÃ¶rsel" style="max-height:200px; border-radius:12px; margin:10px 0;">
                        <p>ğŸ“¸ GÃ¶rsel yÃ¼klendi! AI metni okuyup cevaplayacak...</p>
                    </div>
                `;
                setTimeout(() => {
                    sor("Bu gÃ¶rseldeki metni oku ve cevapla. GÃ¶rselde bir matematik sorusu var.");
                }, 2000);
            };
            reader.readAsDataURL(file);
        }

        // ğŸ­ AI Ä°KÄ°ZÄ°
        function aiIkiz() {
            if (!proMod) {
                alert("ğŸ­ AI Ä°kizim sadece Pro kullanÄ±cÄ±lar iÃ§indir. ğŸ’");
                return;
            }
            sor("Åimdi 'AI Ä°kizim' modundasÄ±n â€” tam olarak benim gibi dÃ¼ÅŸÃ¼n, espri yap, argo kullan, Ã¼slubumla cevap ver. AÅŸaÄŸÄ±daki soruyu cevapla:");
        }

        // â±ï¸ ZAMAN DAMGASI
        function zamanDamgasi() {
            const now = new Date();
            return now.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
        }

        // ğŸ“Š Ä°STATÄ°STÄ°KLERÄ° GÃœNCELLE
        function guncelleIstatistikler() {
            document.getElementById('soruSayisi').innerText = istatistikler.soruSayisi;
            document.getElementById('odevSayisi').innerText = istatistikler.odevSayisi;
            document.getElementById('sesliSure').innerText = istatistikler.sesliSure;
        }

        async function sor(soruOverride = null) {
            const soru = soruOverride || document.getElementById('soru').value.trim();
            const cevapDiv = document.getElementById('cevap');
            const timestampDiv = document.getElementById('timestamp');

            if (!soru) {
                cevapDiv.innerHTML = "âŒ LÃ¼tfen bir soru yaz.";
                return;
            }

            cevapDiv.innerHTML = "<div class='loader'>.Ultra Yapay Zeka dÃ¼ÅŸÃ¼nÃ¼yor... âš¡</div>";
            timestampDiv.innerText = "";
            if (!soruOverride) {
                mesajlar.push({ role: "user", content: soru });
                istatistikler.soruSayisi++;
                localStorage.setItem('istatistikler', JSON.stringify(istatistikler));
                guncelleIstatistikler();
            }

            // ğŸ“² CEBÄ° HAREKETLÄ° YAZSIN
            const card = document.getElementById('mainCard');
            card.classList.add('shake');
            setTimeout(() => card.classList.remove('shake'), 500);

            try {
                const gonderilecekMesajlar = tokenSinirliMesajlar(4500);
                const secilenModel = document.getElementById('modelSec').value;

                const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${GROQ_API_KEY}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        model: secilenModel, // âœ… ALE! Dinamik model seÃ§imi
                        messages: [
                            { role: "system", content: BEN_KIMIM },
                            ...gonderilecekMesajlar
                        ],
                        temperature: 0.7,
                        max_tokens: 512
                    })
                });

                const data = await response.json();
                if (!response.ok) throw new Error(`API HatasÄ±: ${response.status} - ${data.error?.message || "Bilinmeyen hata"}`);

                const cevap = data.choices[0].message.content.trim();
                cevapDiv.innerHTML = cevap;
                timestampDiv.innerText = `CevaplandÄ±: ${zamanDamgasi()}`;

                if (!soruOverride) {
                    mesajlar.push({ role: "assistant", content: cevap.length > 800 ? cevap.substring(0, 800) + "..." : cevap });
                    localStorage.setItem('ultra_sohbet', JSON.stringify(mesajlar));
                }

                sesliOku(cevap);

            } catch (error) {
                cevapDiv.innerHTML = `âš ï¸ Hata: ${error.message}`;
            }
        }

        // Modal dÄ±ÅŸÄ±na tÄ±klanÄ±nca kapat
        window.onclick = function(event) {
            const modal = document.getElementById('proModal');
            if (event.target == modal) {
                kapatProModal();
            }
        }

        // Sayfa yÃ¼klendiÄŸinde Ã§alÄ±ÅŸtÄ±r
        document.addEventListener('DOMContentLoaded', () => {
            yukleApiKeys();
            proKontrol();
            guncelleIstatistikler();
        });
    </script>
</body>
</html>