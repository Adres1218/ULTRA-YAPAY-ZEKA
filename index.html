<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>.Ultra Yapay Zeka.</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="microchip_9751000.png">
    <meta name="theme-color" content="#000000">
    <style>
        :root {
            --bg: #ffffff;
            --card: #f8f9fa;
            --primary: #0066cc;
            --text: #333333;
            --border: #e0e0e0;
            --code-bg: #2d2d2d;
            --code-text: #ffffff;
            --shadow: 0 4px 20px rgba(0,102,204,0.1);
            --pro-bg: linear-gradient(135deg, #ff6b6b, #ee5a52);
            --neon-bg: #0a0a0a;
            --neon-text: #00ffaa;
            --pastel-bg: #fef6ff;
            --pastel-text: #6a5acd;
        }

        [data-theme="dark"] {
            --bg: #121212;
            --card: #1e1e1e;
            --primary: #4da6ff;
            --text: #e0e0e0;
            --border: #333333;
            --code-bg: #1a1a1a;
            --code-text: #ffffff;
        }

        [data-theme="neon"] {
            --bg: var(--neon-bg);
            --card: #1a1a1a;
            --primary: #00ffaa;
            --text: var(--neon-text);
            --border: #00ffaa;
            --code-bg: #000000;
            --code-text: #00ffaa;
        }

        [data-theme="pastel"] {
            --bg: var(--pastel-bg);
            --card: #f0e6ff;
            --primary: #9370db;
            --text: var(--pastel-text);
            --border: #d8bfd8;
            --code-bg: #e6e6fa;
            --code-text: #4b0082;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            padding: 10px;
            margin: 0;
            transition: background 0.3s ease;
            overflow-x: hidden;
            touch-action: pan-y;
        }

        .header {
            text-align: center;
            padding: 20px 10px;
            background: linear-gradient(135deg, var(--primary), #00aaff);
            color: white;
            border-radius: 20px 20px 0 0;
            margin: -10px -10px 20px -10px;
            position: relative;
            overflow: hidden;
        }

        .header h1 {
            font-size: 2em;
            font-weight: 800;
            margin: 0;
            letter-spacing: -1px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            background: linear-gradient(to right, #ffffff, #cce6ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .mode-toggle {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            z-index: 100;
        }

        .card {
            background: var(--card);
            border-radius: 24px;
            padding: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            animation: fadeInUp 0.6s ease;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        textarea {
            width: 100%;
            height: 100px;
            background: var(--bg);
            border: 2px solid var(--border);
            border-radius: 16px;
            color: var(--text);
            padding: 15px;
            font-size: 16px;
            margin: 15px 0;
            resize: none;
            font-family: inherit;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }

        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.15);
            transform: translateY(-2px);
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
            justify-content: center;
        }

        button {
            padding: 14px 20px;
            border: 2px solid var(--border);
            border-radius: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            background: var(--bg);
            color: var(--text);
            font-family: inherit;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1;
            min-width: 120px;
        }

        button:hover {
            background: #f0f7ff;
            transform: translateY(-3px) scale(1.02);
            box-shadow: var(--shadow);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), #0055aa);
            color: white;
            border: none;
            box-shadow: 0 4px 15px rgba(0,102,204,0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #0055aa, #004488);
            transform: translateY(-4px) scale(1.05);
        }

        .pro-btn {
            background: var(--pro-bg);
            color: white;
            border: none;
        }

        #cevap {
            background: var(--bg);
            border: 2px solid var(--border);
            padding: 20px;
            border-radius: 16px;
            margin-top: 20px;
            min-height: 60px;
            line-height: 1.6;
            white-space: pre-wrap;
            font-size: 15px;
            position: relative;
            animation: fadeIn 0.5s ease;
            overflow: hidden;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        #cevap img {
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            margin: 15px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            touch-action: pinch-zoom;
            transition: transform 0.3s ease;
        }

        #cevap img:active {
            transform: scale(1.05);
        }

        #cevap code {
            display: block;
            background: var(--code-bg);
            color: var(--code-text);
            padding: 15px;
            border-radius: 12px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Fira Code', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
        }

        .timestamp {
            font-size: 12px;
            color: #888;
            text-align: right;
            margin-top: 10px;
            font-weight: 500;
        }

        .loader {
            text-align: center;
            padding: 20px;
            color: var(--primary);
            font-weight: 700;
            font-size: 16px;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .theme-toggle {
            position: absolute;
            top: 15px;
            left: 15px;
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 6px 12px;
            border-radius: 50px;
            cursor: pointer;
            z-index: 100;
            font-size: 12px;
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            background: linear-gradient(135deg, #5e72e4, #825ee4);
            color: white;
            border: none;
        }

        .shake {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .floating {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        /* Pro Mod Ekstra Butonlar */
        .pro-features {
            display: none;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .pro-active .pro-features {
            display: flex;
        }

        .pro-badge {
            background: var(--pro-bg);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 8px;
        }

        /* Model Se√ßimi */
        .model-select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: var(--bg);
            color: var(--text);
            font-size: 14px;
            margin: 15px 0;
        }

        /* Oyun Modu */
        .game-btn {
            background: linear-gradient(135deg, #ff9a9e, #fecfef);
            color: #333;
            border: none;
        }

        /* ≈ûarkƒ± Modu */
        .song-btn {
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            color: #333;
            border: none;
        }

        /* ƒ∞statistik Paneli */
        .stats-panel {
            background: var(--card);
            border-radius: 16px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid var(--border);
            display: none;
        }

        .pro-active .stats-panel {
            display: block;
        }

        @media (max-width: 480px) {
            .header h1 { font-size: 1.8em; }
            button { padding: 12px 16px; font-size: 13px; }
            .btn-group { gap: 8px; }
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()">üåô / ‚òÄÔ∏è</button>

    <div class="header">
        <h1>.Ultra Yapay Zeka.</h1>
        <button class="mode-toggle" onclick="acProModal()">Pro Mod üíé</button>
    </div>

    <div class="card" id="mainCard">
        <select class="model-select" id="modelSec">
            <option value="meta-llama/llama-4-scout-17b-16e-instruct">üéØ Genel (Llama 4 Scout)</option>
            <option value="meta-llama/llama-4-maverick-17b-128e-instruct">üë®‚Äçüíª Kod Yazma (Llama 4 Maverick)</option>
            <option value="qwen-qwq-32b">üåç √áok Dilli (Qwen 32B)</option>
        </select>

        <textarea id="soru" placeholder="√ñdev sorunu yaz... veya üéÆ oyun oynamak i√ßin komut ver!"></textarea>
        
        <div class="btn-group">
            <button class="btn-primary" onclick="sor()">
                <span>‚û§ G√∂nder</span>
            </button>
            <button class="btn-secondary upload-btn" onclick="document.getElementById('fileInput').click()" id="uploadBtn">
                <span>üì∏ Fotoƒüraf Y√ºkle</span>
            </button>
            <input type="file" id="fileInput" class="file-input" accept="image/*" onchange="yukle(this.files[0])">
        </div>

        <div class="btn-group pro-features">
            <button class="btn-secondary" onclick="odevYap()">üéì √ñdev Modu</button>
            <button class="btn-secondary game-btn" onclick="oyunBaslat()">üéÆ Oyun Modu</button>
            <button class="btn-secondary song-btn" onclick="sarkiYaz()">üéµ ≈ûarkƒ± Yaz</button>
            <button class="btn-secondary" onclick="aiIkiz()">üé≠ AI ƒ∞kizim</button>
            <button class="btn-secondary" onclick="temizle()">üóëÔ∏è Temizle</button>
            <button class="btn-secondary" onclick="konustur()">üé§ Mikrofon</button>
        </div>

        <div id="cevap">Cevabƒ±n burada g√∂r√ºnecek... üöÄ</div>
        <div class="timestamp" id="timestamp"></div>

        <div class="stats-panel">
            <h3>üìä Bu Haftanƒ±n ƒ∞statistikleri</h3>
            <p>‚úÖ Soru Sayƒ±sƒ±: <span id="soruSayisi">0</span></p>
            <p>üìö √ñdev Sayƒ±sƒ±: <span id="odevSayisi">0</span></p>
            <p>üéß Sesli Dinleme: <span id="sesliSure">0</span> dakika</p>
        </div>
    </div>

    <!-- üíé PRO MODAL -->
    <div id="proModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="kapatProModal()">&times;</span>
            <h2>üíé Ultra Yapay Zeka Pro</h2>
            <p>Yƒ±llƒ±k <strong>100 TL</strong> ‚Äî Aylƒ±k <strong>50 TL</strong></p>
            
            <div class="price-card">
                üìÖ <strong>Yƒ±llƒ±k Abonelik</strong><br>
                100 TL ‚Äî 365 g√ºn Pro eri≈üim
            </div>
            <button class="price-btn" onclick="odemeYap('yƒ±llƒ±k')">üí≥ Yƒ±llƒ±k Satƒ±n Al</button>

            <div class="price-card">
                üìÜ <strong>Aylƒ±k Abonelik</strong><br>
                50 TL ‚Äî 30 g√ºn Pro eri≈üim
            </div>
            <button class="price-btn" onclick="odemeYap('aylƒ±k')">üí≥ Aylƒ±k Satƒ±n Al</button>

            <hr style="margin: 20px 0;">

            <p><strong>üîë Anahtarƒ±nƒ±z var mƒ±?</strong></p>
            <input type="text" id="proKeyInput" class="key-input" placeholder="PRO-ABC123-XYZ789">
            <button class="btn-primary" onclick="anahtarKontrol()">‚úÖ Anahtarƒ± Doƒürula</button>
        </div>
    </div>

    <script>
        // ‚ö†Ô∏è API KEY .env DOSYASINDAN GELECEK ‚Äî GITHUB'DA Gƒ∞ZLƒ∞!
        let GROQ_API_KEY = "";

        // üí¨ M√úKEMMEL KOD YAZIMI + √ñDEV MODU + OYUN + ≈ûARKI PROMPTU
        const BEN_KIMIM = `
Sen "Ultra Yapay Zeka"sƒ±n ‚Äî benim ki≈üisel, s√ºper geli≈ümi≈ü yapay zekam.
EƒûER √ñDEV ƒ∞STENƒ∞YORSA:
- Adƒ±m adƒ±m √ß√∂z.
- Her adƒ±mƒ± ayrƒ±ntƒ±lƒ± a√ßƒ±kla.
- Form√ºlleri yaz, nereden geldiƒüini a√ßƒ±kla.
- √ñrnek hesaplama yap.
- Sonucu kutu i√ßine al.

EƒûER KOD YAZIYORSAN:
- Her satƒ±ra a√ßƒ±klama yaz.
- "Nasƒ±l √ßalƒ±≈üƒ±r?" ve "√ñrnek kullanƒ±m" ekle.
- Hata ayƒ±klama ipu√ßlarƒ± ver.

EƒûER OYUN ƒ∞STENƒ∞YORSA:
- "20 soruda tahmin et" veya "Kelime zinciri" gibi oyunlar ba≈ülat.
- Eƒülenceli ve interaktif ol.

EƒûER ≈ûARKI/≈ûƒ∞ƒ∞R ƒ∞STENƒ∞YORSA:
- Ritimli, duygusal, yaratƒ±cƒ± i√ßerik √ºret.
- M√ºzik t√ºr√ºne g√∂re uygun s√∂zler yaz.

EƒûER AI ƒ∞Kƒ∞Zƒ∞ ƒ∞STENƒ∞YORSA:
- Tam olarak benim gibi d√º≈ü√ºn, espri yap, argo kullan, √ºslubumla cevap ver.

HER ZAMAN SAMƒ∞Mƒ∞, ESPRƒ∞Lƒ∞, "YA" VE "ABƒ∞" DER Gƒ∞Bƒ∞ KONU≈û.

A≈üaƒüƒ±daki soruyu tam olarak bu kurallara g√∂re cevapla:
        `;

        let mesajlar = JSON.parse(localStorage.getItem('ultra_sohbet')) || [];
        let sesDevamEdiyor = false;
        let proMod = false;
        let proBitisTarihi = localStorage.getItem('proBitisTarihi');
        let istatistikler = JSON.parse(localStorage.getItem('istatistikler')) || { soruSayisi: 0, odevSayisi: 0, sesliSure: 0 };

        // Pro mod kontrol√º
        function proKontrol() {
            if (proBitisTarihi) {
                const bitis = new Date(proBitisTarihi);
                const simdiki = new Date();
                if (simdiki < bitis) {
                    proMod = true;
                    document.body.classList.add('pro-active');
                    document.querySelector('.mode-toggle').innerHTML = 'Pro Mod <span class="pro-badge">PRO</span>';
                    document.getElementById('mainCard').classList.add('floating');
                    guncelleIstatistikler();
                } else {
                    proMod = false;
                    localStorage.removeItem('proBitisTarihi');
                    document.body.classList.remove('pro-active');
                    document.querySelector('.mode-toggle').innerText = 'Pro Mod üíé';
                    document.getElementById('mainCard').classList.remove('floating');
                }
            }
        }

        function acProModal() {
            document.getElementById('proModal').style.display = 'block';
        }

        function kapatProModal() {
            document.getElementById('proModal').style.display = 'none';
        }

        function odemeYap(tur) {
            alert(`üí≥ ${tur} abonelik satƒ±n alma sim√ºlasyonu √ßalƒ±≈üƒ±yor...\n\nGer√ßek √∂deme i√ßin Stripe, Iyzico veya Papara entegre edilebilir.`);
            
            const simdiki = new Date();
            if (tur === 'yƒ±llƒ±k') {
                simdiki.setFullYear(simdiki.getFullYear() + 1);
                localStorage.setItem('proBitisTarihi', simdiki.toISOString());
            } else {
                simdiki.setDate(simdiki.getDate() + 30);
                localStorage.setItem('proBitisTarihi', simdiki.toISOString());
            }
            
            proKontrol();
            kapatProModal();
            location.reload();
        }

        function anahtarKontrol() {
            const key = document.getElementById('proKeyInput').value.trim();
            if (key.startsWith('PRO-') && key.length > 10) {
                const simdiki = new Date();
                simdiki.setDate(simdiki.getDate() + 30); // 30 g√ºn ge√ßerli
                localStorage.setItem('proBitisTarihi', simdiki.toISOString());
                alert('‚úÖ Anahtar doƒürulandƒ±! Pro Mod aktif edildi.');
                proKontrol();
                kapatProModal();
                location.reload();
            } else {
                alert('‚ùå Ge√ßersiz anahtar. L√ºtfen ge√ßerli bir Pro Anahtarƒ± girin.');
            }
        }

        function toggleTheme() {
            const themes = ['light', 'dark', 'neon', 'pastel'];
            const currentTheme = document.body.getAttribute('data-theme') || 'light';
            const currentIndex = themes.indexOf(currentTheme);
            const newTheme = themes[(currentIndex + 1) % themes.length];
            document.body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        // Temayƒ± y√ºkle
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.body.setAttribute('data-theme', savedTheme);

        function temizle() {
            localStorage.removeItem('ultra_sohbet');
            mesajlar = [];
            document.getElementById('cevap').innerHTML = "Ge√ßmi≈ü temizlendi. Yeni bir sohbet ba≈ülatabilirsin. üöÄ";
            document.getElementById('timestamp').innerText = "";
        }

        function konustur() {
            if (!('SpeechRecognition' in window) && !('webkitSpeechRecognition' in window)) {
                alert("√úzg√ºn√ºm, bu tarayƒ±cƒ± ses tanƒ±mayƒ± desteklemiyor.");
                return;
            }
            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'tr-TR';
            recognition.start();

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                document.getElementById('soru').value = transcript;
                sor();
            };
        }

        function sesliOku(text) {
            if (sesDevamEdiyor) speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'tr-TR';
            utterance.rate = proMod ? 1.1 : 0.95;
            utterance.pitch = 1.2;
            utterance.onend = () => {
                sesDevamEdiyor = false;
                if (proMod) {
                    istatistikler.sesliSure += Math.ceil(text.length / 100); // Tahmini s√ºre
                    localStorage.setItem('istatistikler', JSON.stringify(istatistikler));
                    guncelleIstatistikler();
                }
            };
            sesDevamEdiyor = true;
            speechSynthesis.speak(utterance);
        }

        function tokenHesapla(metin) {
            return Math.ceil(metin.trim().split(/\s+/).length * 1.3);
        }

        function tokenSinirliMesajlar(maxToken = 4500) {
            const sistemToken = tokenHesapla(BEN_KIMIM);
            let toplamToken = sistemToken;
            const sinirliMesajlar = [];

            const limit = proMod ? 30 : 3; // Pro‚Äôda 30 mesaj, normalde 3

            for (let i = mesajlar.length - 1; i >= 0; i--) {
                if (sinirliMesajlar.length >= limit) break;
                const msgToken = tokenHesapla(mesajlar[i].content);
                if (toplamToken + msgToken > maxToken) break;
                sinirliMesajlar.unshift(mesajlar[i]);
                toplamToken += msgToken;
            }
            return sinirliMesajlar;
        }

        async function yukleApiKeys() {
            try {
                const response = await fetch('/.env');
                if (response.ok) {
                    const text = await response.text();
                    const lines = text.split('\n');
                    for (let line of lines) {
                        if (line.startsWith('GROQ_API_KEY=')) {
                            GROQ_API_KEY = line.split('=')[1].trim();
                        }
                    }
                } else {
                    GROQ_API_KEY = "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";
                }
            } catch (error) {
                console.error("API Key y√ºklenemedi:", error);
                GROQ_API_KEY = "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";
            }
        }

        // ‚ú® √ñDEV MODU
        function odevYap() {
            if (!proMod) {
                alert("üéì √ñdev Modu sadece Pro kullanƒ±cƒ±lar i√ßindir. Pro Mod'a ge√ßmek i√ßin butona tƒ±klayƒ±n.");
                acProModal();
                return;
            }
            const soru = document.getElementById('soru').value.trim();
            if (!soru) {
                alert("√ñnce bir soru yaz!");
                return;
            }
            istatistikler.odevSayisi++;
            localStorage.setItem('istatistikler', JSON.stringify(istatistikler));
            guncelleIstatistikler();
            sor(`A≈ûAƒûIDAKƒ∞ SORUYU √ñDEV OLARAK √á√ñZ ‚Äî ADIM ADIM, AYRINTILI, FORM√úLLERLE, SONUCU KUTU ƒ∞√áƒ∞NDE:\n\n${soru}`);
        }

        // üéÆ OYUN MODU
        function oyunBaslat() {
            const oyunlar = [
                "20 soruda tahmin et: Ben bir ≈üey d√º≈ü√ºn√ºyorum, sen 20 soru sorarak bulmaya √ßalƒ±≈ü.",
                "Kelime zinciri: Ben bir kelime s√∂yl√ºyorum, sen son harfiyle ba≈ülayan bir kelime s√∂yle, ben devam ederim.",
                "Hikaye devam ettir: Ben bir hikaye ba≈ülƒ±ƒüƒ± veriyorum, sen devam ettir, sonra ben devam ederim."
            ];
            const secilenOyun = oyunlar[Math.floor(Math.random() * oyunlar.length)];
            sor(`üéÆ OYUN MODU: ${secilenOyun}\n\nBa≈ülƒ±yoruz!`);
        }

        // üéµ ≈ûARKI YAZ
        function sarkiYaz() {
            const soru = document.getElementById('soru').value.trim();
            if (!soru) {
                alert("√ñnce bir tema yaz! √ñrnek: 'A≈ük i√ßin rap yaz'");
                return;
            }
            sor(`üéµ ≈ûARKI MODU: A≈üaƒüƒ±daki temaya uygun, ritimli, duygusal bir ≈üarkƒ± s√∂z√º yaz:\n\n${soru}`);
        }

        // üì∏ FOTOƒûRAF Y√úKLEME
        function yukle(file) {
            if (!proMod) {
                alert("üì∏ Fotoƒüraf Y√ºkleme sadece Pro kullanƒ±cƒ±lar i√ßindir. Pro Mod'a ge√ßmek i√ßin butona tƒ±klayƒ±n.");
                acProModal();
                return;
            }
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('cevap').innerHTML = `
                    <div style="text-align:center;">
                        <img src="${e.target.result}" alt="Y√ºklenen G√∂rsel" style="max-height:200px; border-radius:12px; margin:10px 0;">
                        <p>üì∏ G√∂rsel y√ºklendi! AI metni okuyup cevaplayacak...</p>
                    </div>
                `;
                setTimeout(() => {
                    sor("Bu g√∂rseldeki metni oku ve cevapla. G√∂rselde bir matematik sorusu var.");
                }, 2000);
            };
            reader.readAsDataURL(file);
        }

        // üé≠ AI ƒ∞Kƒ∞Zƒ∞
        function aiIkiz() {
            if (!proMod) {
                alert("üé≠ AI ƒ∞kizim sadece Pro kullanƒ±cƒ±lar i√ßindir. üíé");
                return;
            }
            sor("≈ûimdi 'AI ƒ∞kizim' modundasƒ±n ‚Äî tam olarak benim gibi d√º≈ü√ºn, espri yap, argo kullan, √ºslubumla cevap ver. A≈üaƒüƒ±daki soruyu cevapla:");
        }

        // ‚è±Ô∏è ZAMAN DAMGASI
        function zamanDamgasi() {
            const now = new Date();
            return now.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
        }

        // üìä ƒ∞STATƒ∞STƒ∞KLERƒ∞ G√úNCELLE
        function guncelleIstatistikler() {
            document.getElementById('soruSayisi').innerText = istatistikler.soruSayisi;
            document.getElementById('odevSayisi').innerText = istatistikler.odevSayisi;
            document.getElementById('sesliSure').innerText = istatistikler.sesliSure;
        }

        async function sor(soruOverride = null) {
            const soru = soruOverride || document.getElementById('soru').value.trim();
            const cevapDiv = document.getElementById('cevap');
            const timestampDiv = document.getElementById('timestamp');

            if (!soru) {
                cevapDiv.innerHTML = "‚ùå L√ºtfen bir soru yaz.";
                return;
            }

            cevapDiv.innerHTML = "<div class='loader'>.Ultra Yapay Zeka d√º≈ü√ºn√ºyor... ‚ö°</div>";
            timestampDiv.innerText = "";
            if (!soruOverride) {
                mesajlar.push({ role: "user", content: soru });
                istatistikler.soruSayisi++;
                localStorage.setItem('istatistikler', JSON.stringify(istatistikler));
                guncelleIstatistikler();
            }

            // üì≤ CEBƒ∞ HAREKETLƒ∞ YAZSIN
            const card = document.getElementById('mainCard');
            card.classList.add('shake');
            setTimeout(() => card.classList.remove('shake'), 500);

            try {
                const gonderilecekMesajlar = tokenSinirliMesajlar(4500);
                const secilenModel = document.getElementById('modelSec').value;

                const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${GROQ_API_KEY}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        model: secilenModel, // ‚úÖ ALE! Dinamik model se√ßimi
                        messages: [
                            { role: "system", content: BEN_KIMIM },
                            ...gonderilecekMesajlar
                        ],
                        temperature: 0.7,
                        max_tokens: 512
                    })
                });

                const data = await response.json();
                if (!response.ok) throw new Error(`API Hatasƒ±: ${response.status} - ${data.error?.message || "Bilinmeyen hata"}`);

                const cevap = data.choices[0].message.content.trim();
                cevapDiv.innerHTML = cevap;
                timestampDiv.innerText = `Cevaplandƒ±: ${zamanDamgasi()}`;

                if (!soruOverride) {
                    mesajlar.push({ role: "assistant", content: cevap.length > 800 ? cevap.substring(0, 800) + "..." : cevap });
                    localStorage.setItem('ultra_sohbet', JSON.stringify(mesajlar));
                }

                sesliOku(cevap);

            } catch (error) {
                cevapDiv.innerHTML = `‚ö†Ô∏è Hata: ${error.message}`;
            }
        }

        // Modal dƒ±≈üƒ±na tƒ±klanƒ±nca kapat
        window.onclick = function(event) {
            const modal = document.getElementById('proModal');
            if (event.target == modal) {
                kapatProModal();
            }
        }

        // Sayfa y√ºklendiƒüinde √ßalƒ±≈ütƒ±r
        document.addEventListener('DOMContentLoaded', () => {
            yukleApiKeys();
            proKontrol();
            guncelleIstatistikler();
        });
    </script>
</body>
</html>